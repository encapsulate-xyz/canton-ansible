canton.validator-apps.validator_backend.storage {
    type = postgres
    config {
        dataSourceClass = "org.postgresql.ds.PGSimpleDataSource"
        properties = {
            databaseName = validator
            currentSchema = validator
            serverName = {{ postgres.server }}
            portNumber = {{ postgres.port }}
            user = {{ postgres.user }}
            password = "{{ postgres.password }}"
            tcpKeepAlive = true
        } 
    }
    parameters {
        migrate-and-start = true
    } 
}

canton {
  parameters {
    # Set to 10x confirmation timeout as suggested by Canton.
    timeouts.processing.sequenced-event-processing-bound = 10m

    # Canton has warns if -Xmx exceeds half of the container's total memory,
    # which is too conservative: we set it to 75% of the container's total memory.
    # This prevents it from logging the warning.
    startup-memory-check-config {
      reporting-level = "ignore"
    }
  }
}

canton.validator-apps.validator_backend.app-instances={}

canton.validator-apps.validator_backend.scan-client.type = "bft"
canton.validator-apps.validator_backend.scan-client.seed-urls = [ "{{ canton.app.scan_address }}" ]

canton.validator-apps.validator_backend {
    domain-migration-id = {{ canton.migration_id }}
}

canton.validator-apps.validator_backend.domain-migration-dump-path = "{{ app_data_dir }}/domain_migration_dump.json"

canton.validator-apps.validator_backend.domains.global.buy-extra-traffic.target-throughput = 20000
canton.validator-apps.validator_backend.domains.global.buy-extra-traffic.min-topup-interval = 1m

{% if migration | default(false) | bool%}
canton.validator-apps.validator_backend.restore-from-migration-dump = "{{ app_data_dir }}/domain_migration_dump.json"
{% endif %}
